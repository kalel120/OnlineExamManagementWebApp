@model OnlineExamManagementWebApp.ViewModels.CourseEditViewModel

@{
    ViewBag.Title = "title";
}

<br />
<ul class="nav nav-tabs">
    <li role="presentation" class="active"><a href="#basic-tab" data-toggle="tab">Basic Info</a></li>
    <li role="presentation"><a href="#assign-trainer" data-toggle="tab">Assign Trainer</a></li>
    <li role="presentation"><a href="#create-exams" data-toggle="tab">Create Exams</a></li>
</ul>

<div class="tab-content">
    <div id="basic-tab" class="tab-pane active">
        <br />
        @Html.HiddenFor(m => m.Id)
        <div class="form-group">
            @Html.LabelFor(m => m.OrganizationCode)
            @Html.TextBoxFor(m => m.OrganizationCode, new { @class = "form-control" })
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.Name)
            @Html.TextBoxFor(m => m.Name, new { @class = "form-control" })
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.Code)
            @Html.TextBoxFor(m => m.Code, new { @class = "form-control" })
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.Duration)
            @Html.TextBoxFor(m => m.Duration, new { @class = "form-control" })
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.Credit)
            @Html.TextBoxFor(m => m.Credit, new { @class = "form-control" })
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.Outline)
            @Html.TextBoxFor(m => m.Outline, new { @class = "form-control" })
        </div>
    </div>

    <div id="assign-trainer" class="tab-pane">
        @{
            Html.RenderPartial("_AssignTrainer");
        }
    </div>
    <div id="create-exams" class="tab-pane"></div>
</div>

@section scripts {
    <script src="~/Scripts/select2.js"></script>
    <script type="text/javascript">
        $(function () {
            $('#ddl-trainers').select2({
                placeholder: "--Select Trainer--",
                ajax: {
                    url: "/Course/GetTrainers",
                    dataType: "json",
                    data: function (params) {
                        return {
                            searchTerm: params.term
                        };
                    },
                    processResults: function (data, params) {
                        return {
                            results: data
                        };
                    }
                }
            });



            // Load assigned trainer from database in assigned trainer tab
            var courseId = $('#Id').val();
            loadTrainersById(courseId);

            function loadTrainersById(courseId) {
                $.ajax({
                    url: "/Course/GetTrainersByCourse/" + courseId,
                    type: "GET",
                    contentType: 'application/json',
                    success: function(result) {
                        var html = '';
                        $.each(result, function(key,item) {
                            html += '<tr>';
                            html += '<td>' + item.Name + '</td>';
                            html += '<td><input type="radio" name="IsLead"/> </td>';
                            html += "<td> <a href='#'> Edit |</a>";
                            html += "<a href='#'> Remove </a></td>";
                            html += '</tr>';
                        });

                        $('#table-body').html(html);
                    },

                    error: function(message) {
                        alert(message.responseText);
                    }
                });
            }

            var index = 0;
            // add to table with with add button click
            $('#add-to-table').click(function () {
                var courseId = $('#Id').val();
                var selectedTrainerId = $('#ddl-trainers').val();
                var selectedTrainerName = $('#ddl-trainers').children("option").filter(":selected").text();


                var tr = "<tr>";
                var tdTrainerName = "<td><input type='hidden' name='Trainers[" + index + "].Id' value='" + selectedTrainerId + "'/>";
                tdTrainerName += "<input type='hidden' name='CourseId' value='" + courseId + "'/>";
                tdTrainerName += selectedTrainerName;
                tdTrainerName += "</td>";

                var tdIsLead = '<td><input type="radio" name="IsLead"/> </td>';

                var tdAction = "<td> <a href='#'> Edit |</a>";
                tdAction += "<a href='#'> Remove </a>";
                tdAction += "</td>";

                tr += tdTrainerName + tdIsLead + tdAction + "</tr>";

                $('#table-body').append(tr);
                index++;
            });

        });
    </script>
}
